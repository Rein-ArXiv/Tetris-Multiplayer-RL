# 친구와 테트리스 멀티플레이 하기

## 준비물

1. **두 대의 컴퓨터** (Windows/Linux)
2. **인터넷 연결** (같은 공유기 또는 인터넷을 통해)
3. **컴파일된 tetris.exe** (양쪽 모두)
4. **필요한 파일들** (Font/, Sounds/ 폴더)

## 🚀 빠른 시작 (같은 네트워크 내)

가장 간단한 방법입니다. 집이나 카페에서 같은 WiFi를 사용하는 경우:

### 호스트 (게임 방 만드는 사람)
1. `tetris.exe` 실행
2. "Host (port 7777)" 선택
3. 화면에 나타나는 IP 주소를 친구에게 알려주기 (예: 192.168.1.100:7777)

### 클라이언트 (참가하는 사람)
1. `tetris.exe` 실행
2. "Connect (enter IP:port)" 선택
3. 친구가 알려준 IP:port 입력 (예: 192.168.1.100:7777)

### 예상되는 화면
```
호스트:
┌─────────────────────────────┐
│ Hosting on port 7777        │
│ Your IP: 192.168.1.100      │
│ Tell your friend to connect │
│ 192.168.1.100:7777         │
│ Waiting for connection...   │
└─────────────────────────────┘

클라이언트:
┌─────────────────────────────┐
│ Enter IP:port               │
│ ┌─────────────────────────┐ │
│ │192.168.1.100:7777      │ │
│ └─────────────────────────┘ │
└─────────────────────────────┘
```

## 🌐 인터넷을 통한 플레이

친구가 다른 장소에 있는 경우 (집-집, 집-회사 등):

### 1단계: 공인 IP 주소 확인
호스트는 자신의 공인 IP 주소를 확인해야 합니다:
- 웹브라우저에서 `whatismyip.com` 또는 `ipconfig.me` 접속
- 또는 명령창에서 `curl ipconfig.me` 실행

### 2단계: 공유기 포트포워딩 설정
호스트의 공유기/라우터 설정에서 포트 7777을 포워딩해야 합니다:

1. **공유기 관리자 페이지 접속**
   - 웹브라우저에서 `192.168.1.1` 또는 `192.168.0.1` 접속
   - 또는 `ipconfig` 명령에서 "기본 게이트웨이" 주소 확인

2. **포트포워딩 설정**
   ```
   서비스명: Tetris
   외부포트: 7777
   내부포트: 7777
   내부IP: [호스트 컴퓨터의 로컬IP]
   프로토콜: TCP
   ```

3. **공유기별 설정 위치**
   - **ipTIME**: 고급설정 > NAT/라우터 관리 > 포트포워드 설정
   - **NETGEAR**: Dynamic DNS > 포트포워딩/포트트리거링
   - **ASUS**: WAN > 가상서버/포트포워딩
   - **TP-Link**: Advanced > NAT Forwarding > Port Forwarding

### 3단계: 방화벽 설정
Windows Defender 방화벽에서 포트 허용:

1. **Windows 설정**
   - 제어판 > 시스템 및 보안 > Windows Defender 방화벽
   - "Windows Defender 방화벽을 통해 앱 또는 기능 허용"
   - "설정 변경" > "다른 앱 허용" > tetris.exe 추가

2. **또는 명령창에서** (관리자 권한 필요):
   ```cmd
   netsh advfirewall firewall add rule name="Tetris" dir=in action=allow protocol=TCP localport=7777
   ```

### 4단계: 연결 테스트
- 호스트: `tetris.exe --host 7777`
- 클라이언트: `tetris.exe --connect [공인IP]:7777`

## ❌ 문제 해결

### "Connection Failed!" 메시지가 뜰 때

1. **IP 주소 확인**
   - 로컬 네트워크: `192.168.x.x` 또는 `10.x.x.x` 형태
   - 인터넷: 공인 IP 주소 (whatismyip.com에서 확인)

2. **포트 확인**
   - 기본값: 7777
   - 다른 프로그램이 사용 중이면 다른 포트 시도 (예: 7778)

3. **방화벽/보안 프로그램**
   - Windows Defender, 백신 프로그램 임시 해제 후 테스트
   - 회사/학교 네트워크는 포트가 막혀있을 수 있음

4. **공유기 문제**
   - 공유기 재시작
   - UPnP 자동 포트포워딩 활성화 확인
   - DMZ 설정 (보안상 권장하지 않음)

### "Connection timeout" 메시지가 뜰 때
- 10초 이내에 연결되지 않음
- IP 주소나 포트가 틀렸거나 도달할 수 없는 상태
- 상대방이 게임을 실행하지 않았거나 다른 모드로 실행

### 게임은 시작되는데 블록이 다를 때
- 이전 버전의 버그 (현재는 수정됨)
- 양쪽이 같은 버전의 tetris.exe를 사용하는지 확인

### 게임 중 연결이 끊어질 때
- 네트워크 불안정
- 한쪽이 게임을 강제 종료
- 현재는 재연결 기능이 없으므로 다시 연결 필요

## 🔧 고급 설정

### 다른 포트 사용하기
기본 포트 7777이 막혀있거나 사용 중인 경우:
```bash
# 호스트
tetris.exe --host 8888

# 클라이언트
tetris.exe --connect 192.168.1.100:8888
```

### 명령줄에서 바로 시작
메뉴 없이 바로 네트워크 모드로 시작:
```bash
# 호스트 (포트 7777에서 대기)
tetris.exe --host

# 클라이언트 (localhost에 연결)
tetris.exe --connect localhost:7777
```

### 연결 상태 디버깅
게임 실행 시 콘솔창에서 네트워크 상태 확인 가능:
```
[NET] Starting to listen on port 7777
[NET] Local IP detected: 192.168.1.100
[NET] Client connected!
[NET] Queued HELLO message
[NET] Sending packet of size 11
[NET] Received HELLO message
[NET] Host session is ready!
```

## 📱 모바일 핫스팟 이용하기

집에 인터넷이 없거나 포트포워딩이 어려운 경우:

1. **한명이 모바일 핫스팟 생성**
2. **다른 사람이 핫스팟에 연결**
3. **호스트는 핫스팟을 만든 사람**
4. **클라이언트는 핫스팟에 연결한 사람**

이 경우 NAT/방화벽 문제가 적어서 더 쉽게 연결됩니다.

## 🎯 성공률 높이는 팁

1. **같은 네트워크에서 먼저 테스트**
   - WiFi 핫스팟이나 유선 허브로 연결된 상태에서 테스트

2. **IP 주소를 정확히 확인**
   - 호스트 화면에 표시되는 IP 주소 그대로 입력
   - 복사-붙여넣기 권장

3. **실행 순서 맞추기**
   - 호스트 먼저 실행하고 "Waiting for connection" 뜰 때
   - 클라이언트가 연결 시도

4. **게임 파일 구성 확인**
   ```
   tetris.exe
   Font/
   ├── monogram.ttf
   Sounds/
   ├── clear.wav
   ├── drop.wav
   └── ... (다른 사운드 파일들)
   ```

이제 친구와 함께 테트리스 대전을 즐기세요! 🎮